# 实验室用户管理（lab_user）与成果管理接口汇总

> 代码来源：`agileboot-admin` 模块下的 `com.agileboot.admin.controller.lab`、`com.agileboot.admin.controller.open` 以及 `agileboot-domain` 对应的 DTO/Command。

## 1. 基础信息

- **Base URL**：`http://{host}:8080`
- **认证方式**：除 `/open/**` 以外接口均需携带 `Authorization: Bearer <JWT>`，权限控制由 `@PreAuthorize` 标注。
- **默认数据格式**：`application/json;charset=UTF-8`
- **时间/日期字段**：遵循 ISO-8601（如 `yyyy-MM-dd`）。

### 1.1 通用响应体

所有业务接口均返回 `ResponseDTO<T>`：

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `code` | Integer | 业务状态码，`200` 表示成功 |
| `msg` | String | 对应提示信息 |
| `data` | T | 具体数据载荷，可为对象、数组、分页数据等 |

分页接口的 `data` 通常为 `PageDTO<T>`：

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `total` | Long | 记录总数 |
| `rows` | List\<T> | 当前页数据列表 |

## 2. 用户管理接口（lab_user，排除 system_user）

### 2.1 用户信息查询（`LabUserController`）

#### 获取当前登录用户信息
- **方法 / 地址**：`GET /lab/users/profile`
- **权限**：登录即可
- **请求参数**：无
- **返回结果**：`ResponseDTO<LabUserProfileDTO>`（字段见[2.7](#27-用户相关通用数据结构)）

#### 根据用户 ID 获取信息
- **方法 / 地址**：`GET /lab/users/{userId}`
- **权限**：`lab:user:query` 或访问本人
- **请求参数**：
  | 名称 | 位置 | 类型 | 必填 | 说明 |
  | --- | --- | --- | --- | --- |
  | `userId` | path | Long | 是 | 实验室用户 ID |
- **返回结果**：`LabUserProfileDTO`

#### 根据用户名获取信息
- **方法 / 地址**：`GET /lab/users/username/{username}`
- **权限**：`lab:user:query` 或访问本人
- **请求参数**：
  | 名称 | 位置 | 类型 | 必填 | 说明 |
  | --- | --- | --- | --- | --- |
  | `username` | path | String | 是 | 登录用户名 |
- **返回结果**：`LabUserProfileDTO`

#### 检查用户是否存在
- **方法 / 地址**：`GET /lab/users/{userId}/exists`
- **权限**：登录即可
- **返回结果**：`data` 为 `Boolean`

#### 检查用户名是否存在
- **方法 / 地址**：`GET /lab/users/username/{username}/exists`
- **权限**：登录即可
- **返回结果**：`Boolean`

#### 用户搜索（别名）
- **方法 / 地址**：`GET /lab/users/search?keyword=`
- **权限**：`lab:user:list` 或管理员
- **请求参数**：
  | 名称 | 位置 | 类型 | 必填 | 说明 |
  | --- | --- | --- | --- | --- |
  | `keyword` | query | String | 是 | 支持姓名 / 用户名 / 邮箱模糊匹配 |
- **返回结果**：`List<LabUserProfileDTO>`

#### 用户服务健康检查
- **方法 / 地址**：`GET /lab/users/test/health`
- **权限**：无需登录
- **返回**：`String` 描述运行状态

### 2.2 用户 CRUD（`LabUserCrudController`）

#### 创建实验室用户
- **方法 / 地址**：`POST /lab/users/crud`
- **权限**：`lab:user:add` 或管理员
- **请求体**：`CreateLabUserCommand`（见[2.7](#27-用户相关通用数据结构)）
- **返回**：`Long` 新用户 ID

#### 管理员更新用户
- **方法 / 地址**：`PUT /lab/users/crud/{userId}`
- **权限**：`lab:user:edit` 或管理员
- **请求体**：`UpdateLabUserCommand`
- **返回**：空 `data`

#### 用户自助更新个人信息
- **方法 / 地址**：`PUT /lab/users/crud/profile`
- **权限**：登录用户
- **请求体**：`UpdateProfileCommand`

#### 用户自助修改密码
- **方法 / 地址**：`PUT /lab/users/crud/password`
- **权限**：登录用户
- **请求体**：`ChangePasswordCommand`
- **返回**：空

#### 管理员重置密码
- **方法 / 地址**：`PUT /lab/users/crud/{userId}/password`
- **权限**：`lab:user:edit` 或管理员
- **请求体**：`ResetLabUserPasswordCommand`
- **说明**：无需旧密码

#### 删除单个用户
- **方法 / 地址**：`DELETE /lab/users/crud/{userId}`
- **权限**：`lab:user:remove` 或管理员
- **返回**：空

#### 分页查询用户列表
- **方法 / 地址**：`GET /lab/users/crud/list`
- **权限**：`lab:user:list` 或管理员
- **查询参数**：`LabUserQuery`（见[2.7](#27-用户相关通用数据结构)）
- **返回**：`PageDTO<LabUserProfileDTO>`

#### 关键词搜索
- **方法 / 地址**：`GET /lab/users/crud/search?keyword=`
- **权限**：无需登录
- **返回**：`List<LabUserProfileDTO>`

### 2.3 批量/导入/导出

| 接口 | 方法 & 地址 | 权限 | 请求体 / 参数 | 返回结果 |
| --- | --- | --- | --- | --- |
| 批量删除 | `DELETE /lab/users/crud/batch` | `lab:user:remove` | JSON 数组 `[Long userId, ...]` | 空 |
| 批量启用/禁用 | `PUT /lab/users/crud/batch/status?isActive=` | `lab:user:edit` | Body：`List<Long>`；Query：`isActive(Boolean)` | 空（当前实现预留，后端尚未完成状态更新逻辑） |
| 获取统计信息 | `GET /lab/users/crud/statistics` | `lab:user:list` | 无 | `{"message":"统计功能待实现"}` |
| 导出用户 | `GET /lab/users/crud/export` | `lab:user:export` | `LabUserQuery` | 字符串 `"导出功能待实现"` |
| 导入用户 | `POST /lab/users/crud/import` | `lab:user:import` | 暂无参数（实现预留） | `"导入功能待实现"` |

### 2.4 头像上传

| 接口 | 方法 & 地址 | 权限 | 请求字段 | 返回 |
| --- | --- | --- | --- | --- |
| 用户自助上传头像 | `POST /lab/users/crud/profile/photo` | 登录 | `multipart/form-data`，字段 `photofile`（文件，必选） | `UploadFileDTO`（字段见[2.7](#27-用户相关通用数据结构)） |
| 管理员上传指定用户头像 | `POST /lab/users/crud/{userId}/photo` | `lab:user:edit` | 同上，另需 path `userId` | `UploadFileDTO` |

### 2.5 师生关系（`LabUserRelationshipController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 创建关系 | `POST /lab/users/relationships` | `lab:user:relationship:create` | Body：`CreateUserRelationshipCommand` | `Long` 关系 ID |
| 解除关系 | `DELETE /lab/users/relationships/teacher/{teacherId}/student/{studentId}` | `lab:user:relationship:delete` | Path：`teacherId`、`studentId` | 空 |
| 查询导师学生 | `GET /lab/users/relationships/teacher/{teacherId}/students?status=` | `lab:user:relationship:query` | `status` 可空（1 活跃/2 结束） | `List<UserRelationshipDTO>` |
| 查询学生导师 | `GET /lab/users/relationships/student/{studentId}/supervisor?status=` | 同上 | Path：`studentId` | `UserRelationshipDTO` |
| 更换导师 | `PUT /lab/users/relationships/student/{studentId}/supervisor/{newTeacherId}?remark=` | `lab:user:relationship:update` | Path：学生、新导师；Query：可选 `remark` | `Long` 新关系 ID |
| 快捷添加学生 | `POST /lab/users/relationships/teacher/{teacherId}/student/{studentId}?remark=` | `lab:user:relationship:create` | 同上 | `Long` |
| 获取活跃学生 | `GET /lab/users/relationships/teacher/{teacherId}/active-students` | `lab:user:relationship:query` | Path：`teacherId` | `List<UserRelationshipDTO>`（仅活跃） |
| 获取活跃导师 | `GET /lab/users/relationships/student/{studentId}/active-supervisor` | 同上 | Path：`studentId` | `UserRelationshipDTO` |

### 2.6 公开用户接口（`OpenLabController`）

| 接口 | 方法 & 地址 | 权限 | 请求参数 | 返回 |
| --- | --- | --- | --- | --- |
| 公开用户列表 | `GET /open/users` | 公开 | `pageNum`(默认1)、`pageSize`(默认1000)、`identity`、`academicStatus`、`status`、`keyword` | `ResponseDTO<PageDTO<PublicLabUserDTO>>`（同时附带 HTTP 缓存头） |
| 公开用户详情 | `GET /open/users/{id}` | 公开 | Path：`id` | `ResponseDTO<PublicLabUserDTO>`，当用户不存在或未激活时 `data=null` |

### 2.7 用户相关通用数据结构

#### LabUserProfileDTO
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` | Long | 用户 ID |
| `studentNumber` | String | 学号/工号 |
| `username` | String | 登录用户名 |
| `realName` / `englishName` | String | 中文/英文姓名 |
| `gender` / `genderDesc` | Integer / String | 性别编码及描述（0 未知 /1 男 /2 女） |
| `identity` / `identityDesc` | Integer / String | 身份（1 管理员 /2 教师 /3 学生） |
| `academicStatus` / `academicStatusDesc` | Integer / String | 学术身份（0~6） |
| `researchArea` | String | 研究方向 |
| `phone` / `email` | String | 联系方式 |
| `status` / `statusDesc` | Integer / String | 在读/毕业状态 |
| `enrollmentYear` / `graduationYear` | Year | 入学/毕业年份 |
| `graduationDest` | String | 毕业去向 |
| `photo` | String | 头像 URL |
| `resume` | String | 简历 |
| `homepageUrl` | String | 主页 |
| `orcid` | String | ORCID |
| `isActive` | Boolean | 是否启用 |
| `createTime` / `updateTime` | String | 记录时间戳 |

#### CreateLabUserCommand / UpdateLabUserCommand / UpdateProfileCommand

| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `studentNumber` | String | 选填 | 学/工号，长度上限 20/50 |
| `username` | String | 创建时必填 | 仅 `CreateLabUserCommand` 包含，3~50 字母数字下划线 |
| `realName` | String | 必填 | 中文姓名 |
| `englishName` | String | 选填 | 英文姓名 |
| `password` | String | 创建时必填 | 6~20 位 |
| `gender` | Integer | 选填 | 0/1/2 |
| `identity` | Integer | 更新/创建必填 | 1=管理员 2=教师 3=学生 |
| `academicStatus` | Integer | 选填 | 0~6 |
| `researchArea` | String | 选填 |
| `phone` | String | 选填 | 手机号或空 |
| `email` | String | 选填 | 邮箱 |
| `status` | Integer | 选填 | 1=在读/在职 2=毕业/离职 |
| `enrollmentYear` / `graduationYear` | Year | 选填 |
| `graduationDest` | String | 选填 |
| `photo` | String | Update 命令可直接设置头像路径 |
| `resume` | String | 选填 |
| `homepageUrl` | String | 选填 |
| `orcid` | String | 选填 |
| `isActive` | Boolean | 选填 |
| `fundIds` 等 | — | （无） |

> `UpdateProfileCommand` 字段同上但无 `username/password/identity`，并允许用户自助修改。

#### ChangePasswordCommand
| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `oldPassword` | String | 是 | 旧密码 |
| `newPassword` | String | 是 | 6~20 位 |
| `confirmPassword` | String | 是 | 新密码确认 |

#### ResetLabUserPasswordCommand
| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `password` | String | 是 | 新密码，6~20 位 |

#### LabUserQuery
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `pageNum` / `pageSize` | Integer | 分页参数，默认按创建时间降序 |
| `username` / `realName` / `englishName` | String | 支持模糊匹配 |
| `identity` / `academicStatus` | Integer | 身份筛选 |
| `researchAreaKeyword` | String | 研究方向模糊 |
| `email` / `phone` | String | 联系方式筛选 |
| `status` | Integer | 在读/毕业 |
| `enrollmentYearStart` / `enrollmentYearEnd` | Year | 入学年份区间 |
| `isActive` | Boolean | 启用状态 |
| `keyword` | String | 综合关键词（姓名/用户名/邮箱） |
| `orderColumn` / `orderDirection` | String | 自定义排序字段与方向 |

#### UploadFileDTO
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `imgUrl` | String | 成功上传后的访问路径 |

#### CreateUserRelationshipCommand
| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `teacherId` | Long | 是 | 导师 ID |
| `studentId` | Long | 是 | 学生 ID |
| `relationshipType` | Integer | 否 | 默认 1=导师关系 |
| `startDate` | LocalDate | 否 | 关系开始日 |
| `remark` | String | 否 | 备注 |

#### UserRelationshipDTO
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` | Long | 关系 ID |
| `teacherId` / `studentId` | Long | 成员 ID |
| `relationshipType` / `relationshipTypeDesc` | Integer / String | 关系类型 |
| `startDate` / `endDate` | LocalDate | 时间范围 |
| `status` / `statusDesc` | Integer / String | 1=活跃 2=已结束 |
| `remark` | String | 备注 |
| `teacher` / `student` | `PublicLabUserDTO` | 公开用户信息 |
| `createTime` / `updateTime` | Date | 记录时间 |

#### PublicLabUserDTO
字段同 `LabUserProfileDTO` 的公开子集（无敏感字段）。

---

## 3. 成果管理接口

### 3.1 成果主数据（`LabAchievementController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 成果分页列表 | `GET /lab/achievements` | `lab:achievement:list`（非管理员只返回本人参与成果） | Query：`LabAchievementQuery`，并支持 `excludeProject`、`parentCategoryId`、`categoryId` 显式覆盖 | `PageDTO<LabAchievementDTO>` |
| 成果详情 | `GET /lab/achievements/{id}` | `lab:achievement:query` | Path：`id` | `LabAchievementDTO` |
| 创建成果 | `POST /lab/achievements` | `lab:achievement:add` | Body：`CreateLabAchievementCommand` | `Long` 新成果 ID |
| 更新成果 | `PUT /lab/achievements/{id}` | `lab:achievement:edit` | Body：`CreateLabAchievementCommand` | 空 |
| 删除成果 | `DELETE /lab/achievements/{id}` | `lab:achievement:remove` | Path：`id` | 空 |
| 发布/撤销发布 | `PUT /lab/achievements/{id}/publish?published=` | 登录 | Query：`published` Boolean | 空 |
| 审核 | `PUT /lab/achievements/{id}/verify?verified=` | `lab:achievement:verify` | Query：`verified` Boolean | 空 |
| 查询基金关联 | `GET /lab/achievements/{id}/funds` | `lab:achievement:query` | Path：`id` | `List<LabFundAssociationDTO>` |
| 更新基金关联 | `PUT /lab/achievements/{id}/funds` | `lab:achievement:edit` | Body：`List<FundAssociationCommand>` | 空 |

> 创建/更新接口会自动识别当前实验室用户并写入 `ownerUserId`。

### 3.2 成果作者（`LabAchievementAuthorController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 作者列表 | `GET /lab/achievements/{achievementId}/authors` | `lab:achievement:query` | Path：`achievementId` | `List<LabPaperAuthorDTO>` |
| 新增作者 | `POST /lab/achievements/{achievementId}/authors` | `lab:achievement:edit`（需成果所有者或管理员） | Body：`AddAuthorCommand` | `Long` 作者 ID |
| 更新作者 | `PUT /lab/achievements/{achievementId}/authors/{authorId}` | 同上 | Body：`UpdateAuthorCommand` | 空 |
| 删除作者 | `DELETE /lab/achievements/{achievementId}/authors/{authorId}` | 同上 | 无 | 空 |
| 调整顺序 | `PUT /lab/achievements/{achievementId}/authors/{authorId}/reorder?newOrder=` | 同上 | Query：`newOrder` >=1 | 空 |
| 切换可见性 | `PUT /lab/achievements/{achievementId}/authors/{authorId}/visibility?visible=` | 同上 | Query：`visible` Boolean | 空 |

### 3.3 我的成果（`LabMyAchievementController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 我的成果列表 | `GET /lab/my-achievements` | 登录 | Query：`MyAchievementQuery` | `PageDTO<LabAchievementDTO>`（附 `myVisibility` 字段） |
| 切换个人可见性 | `PUT /lab/my-achievements/{achievementId}/visibility?visible=` | 登录作者本人 | Query：`visible` Boolean | `Boolean`（实际状态） |

### 3.4 成果管理 v2（`LabAchievementV2Controller`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 创建成果 v2 | `POST /v2/lab/achievements` | `lab:achievement:add` | Body：`CreateLabAchievementV2Command`（仅允许传 `categoryId`，禁止 legacy 字段） | `Long` |
| 更新成果 v2 | `PUT /v2/lab/achievements/{id}` | `lab:achievement:edit` | 同上 | 空 |

### 3.5 成果类型管理（`LabAchievementCategoryController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 类型树 | `GET /lab/achievement-categories?includeInactive=` | `lab:category:list` | Query：`includeInactive`(默认 false) | `List<LabAchievementCategoryDTO>` |
| 分页列表 | `GET /lab/achievement-categories/list` | `lab:category:list` | Query：`CategoryQuery` | `PageDTO<LabAchievementCategoryDTO>` |
| 类型详情 | `GET /lab/achievement-categories/{id}` | `lab:category:query` | Path：`id` | `LabAchievementCategoryDTO` |
| 创建类型 | `POST /lab/achievement-categories` | `lab:category:add` | Body：`CreateCategoryCommand` | `Long` |
| 更新类型 | `PUT /lab/achievement-categories/{id}` | `lab:category:edit` | Body：`UpdateCategoryCommand` | 空 |
| 删除类型 | `DELETE /lab/achievement-categories/{id}` | `lab:category:remove` | Path：`id` | 空 |
| 批量排序 | `PUT /lab/achievement-categories/batch/sort` | `lab:category:sort` | Body：`BatchUpdateSortCommand` | 空 |
| 启用/禁用 | `PUT /lab/achievement-categories/{id}/status?active=` | `lab:category:edit` | Query：`active` Boolean | 空 |
| 强制删除“未分类” | `DELETE /lab/achievement-categories/force-delete-uncategorized` | 仅管理员 | 无 | 空 |

### 3.6 成果类型兼容性（`LabAchievementCategoryCompatibilityController`）

| 接口 | 方法 & 地址 | 权限 | 说明 | 返回 |
| --- | --- | --- | --- | --- |
| 获取新旧类型映射 | `GET /lab/achievement-categories/compatibility/mapping` | `lab:category:list` | 返回当前映射详情 | `Map` |
| 检查迁移状态 | `GET /lab/achievement-categories/compatibility/migrate` | 同上 | 返回迁移指标 | `Map` |
| 旧类型 -> 新类型 | `GET /lab/achievement-categories/compatibility/legacy-to-new?type=&subType=` | 同上 | `type`：1 论文/2 项目，`subType` 见附录 | `Long` `categoryId` |
| 新类型 -> 旧类型 | `GET /lab/achievement-categories/compatibility/new-to-legacy?categoryId=` | 同上 | 返回 `LegacyTypeMapping`（见[3.12](#312-成果相关通用数据结构)） |

### 3.7 实验室字典接口（`LabDictController`）

| 接口 | 地址 | 权限 | 返回 |
| --- | --- | --- | --- |
| 学术身份字典 | `GET /lab/dicts/academic-status` | 公开 | `List<DictItem>`（value/label） |
| 成果类型字典 | `GET /lab/dicts/achievement-types` | 公开 | 1=论文，2=项目 |
| 论文类型字典 | `GET /lab/dicts/paper-types` | 公开 | 1~7 详情 |
| 项目类型字典 | `GET /lab/dicts/project-types` | 公开 | 1~8 详情 |
| 成果分类树 | `GET /lab/dicts/achievement-categories?includeInactive=` | 公开 | `List<LabAchievementCategoryDTO>` |
| 成果分类扁平列表 | `GET /lab/dicts/achievement-categories/flat?includeInactive=` | 公开 | `List<CategoryFlatItem>`（id/code/name/nameEn/parentId/level） |

### 3.8 论文管理（`LabPaperController` & `OpenPaperController`）

> 成果拆分后，论文业务完全由 `/lab/papers` 系列接口承载；公开展示统一复用 `/open/papers`，只输出已发布论文。

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 后台论文列表 | `GET /lab/papers` | `lab:paper:query` | Query：`LabPaperQuery` | `PageDTO<LabPaperDTO>` |
| 后台论文详情 | `GET /lab/papers/{id}` | `lab:paper:query` | Path：`id` | `LabPaperDTO` |
| 创建论文 | `POST /lab/papers` | `lab:paper:add` | Body：`CreatePaperCommand` | `Long` |
| 更新论文 | `PUT /lab/papers/{id}` | `lab:paper:edit` | Body：`UpdatePaperCommand` | 空 |
| 删除论文 | `DELETE /lab/papers/{id}` | `lab:paper:remove` | Path：`id` | 空 |
| 论文基金列表 | `GET /lab/papers/{id}/funds` | `lab:paper:query` | Path：`id` | `List<LabFundAssociationDTO>` |
| 更新论文基金 | `PUT /lab/papers/{id}/funds` | `lab:paper:edit` | Body：`List<CreatePaperCommand.PaperFundCommand>` | 空 |
| 公开论文列表 | `GET /open/papers` | 公开 | Query：`PublicPaperQuery`（默认 `published=true`） | `PageDTO<LabPaperDTO>` |
| 公开论文详情 | `GET /open/papers/{id}` | 公开 | Path：`id` | `LabPaperDTO`（若未发布则 404） |

### 3.9 项目管理（`LabProjectController` & `OpenProjectController`）

> 项目不再经过成果模块，统一走 `/lab/projects`；开放接口 `/open/projects` 仅返回 `published && verified` 的项目，供门户展示。

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 后台项目列表 | `GET /lab/projects` | `lab:project:query` | Query：`LabProjectQuery` | `PageDTO<LabProjectDTO>`（含作者列表） |
| 后台项目详情 | `GET /lab/projects/{id}` | `lab:project:query` | Path：`id` | `LabProjectDTO`（含作者列表） |
| 创建项目 | `POST /lab/projects` | `lab:project:add` | Body：`CreateProjectCommand` | `Long` |
| 更新项目 | `PUT /lab/projects/{id}` | `lab:project:edit` | Body：`UpdateProjectCommand` | 空 |
| 删除项目 | `DELETE /lab/projects/{id}` | `lab:project:remove` | Path：`id` | 空 |
| 切换发布 | `PUT /lab/projects/{id}/publish?published=` | `lab:project:edit` | Query：`published` | 空 |
| 审核 | `PUT /lab/projects/{id}/verify?verified=` | `lab:project:verify` | Query：`verified` | 空 |
| 公开项目列表 | `GET /open/projects` | 公开 | Query：`LabProjectQuery`（仅返回发布且审核通过项目） | `PageDTO<LabProjectDTO>`（含作者列表） |
| 公开项目详情 | `GET /open/projects/{id}` | 公开 | Path：`id` | `LabProjectDTO`（含作者列表，需已发布） |

### 3.10 公开成果接口（`OpenAchievementController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 公开成果列表 | `GET /open/achievements` | 公开 | Query：`PublicAchievementQuery`，并支持 `parentCategoryId`、`categoryId` | `PageDTO<PublicAchievementDTO>` |
| 公开成果详情 | `GET /open/achievements/{id}` | 公开 | Path：`id` | `PublicAchievementDTO` |

### 3.11 公开成果分类（`OpenCategoryController`）

| 接口 | 方法 & 地址 | 权限 | 请求 | 返回 |
| --- | --- | --- | --- | --- |
| 分类树/叶子列表 | `GET /open/achievement-categories?includeInactive=&onlyLeaf=` | 公开 | `includeInactive` 默认 false；`onlyLeaf` 默认 false（为 true 时仅返回二级分类数组） | `ResponseDTO<List<LabAchievementCategoryDTO>>`（带缓存） |
| 查询子分类 | `GET /open/achievement-categories/children?parentId=&includeInactive=` | 公开 | `parentId` 必填 | 指定父类的直接子节点列表 |

### 3.12 成果相关通用数据结构

#### LabAchievementQuery / MyAchievementQuery / PublicAchievementQuery

公共字段：
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `pageNum` / `pageSize` | Integer | 分页参数 |
| `keyword` | String | 标题/关键词模糊 |
| `type` | Integer | 成果类型（1=论文 2=项目） |
| `excludeProject` | Boolean | true 时排除项目（仅部分查询） |
| `paperType` / `projectType` | Integer | 子类型 |
| `categoryId` / `parentCategoryId` | Long | 新分类体系筛选 |
| `published` / `isVerified` | Boolean | 发布/审核状态（公开接口默认 true） |
| `dateStart` / `dateEnd` | LocalDate | 对论文使用 `publishDate`，项目使用 `projectStartDate` |
| `authorUserId` / `authorName` / `authorEmail` | 公开接口可用，用于按作者过滤 |
| `ownerUserId` / `ownerName` | 后台列表可用 |

> `MyAchievementQuery` 额外支持 `authorName`（模糊作者姓名）和 `ownerName`（拥有者姓名），公开接口 `PublicAchievementQuery` 默认仅返回 `published && is_verified` 数据且分页默认 `pageSize=1000`。

#### CreateLabAchievementCommand / CreateLabAchievementV2Command

| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `title` / `titleEn` | String | 标题必填 | 中英文标题 |
| `description` | String | 否 | 摘要/描述 |
| `keywords` | String | 否 | 关键词 |
| `type` | Integer | legacy 必填 | 1=论文 2=项目（v2 禁用，自动由分类推导） |
| `paperType` / `projectType` | Integer | 视类型而定 | 论文/项目子类型（v2 禁用） |
| `categoryId` | Long | v2 必填 | 新分类叶子节点 |
| `venue` | String | 否 | 期刊/会议/发布渠道 |
| `publishDate` | String | 否 | yyyy 或 yyyy-MM-dd |
| `projectStartDate` / `projectEndDate` | String | 否 | yyyy-MM |
| `reference` | String | 否 | 参考文献 |
| `linkUrl` / `gitUrl` / `homepageUrl` / `pdfUrl` | String | 否 | 外链 |
| `doi` | String | 否 | DOI |
| `fundingAmount` | BigDecimal | 否 | 项目经费（万元） |
| `published` | Boolean | 否 | 是否对外展示，默认 false |
| `extra` | String | 否 | 自定义扩展 JSON |
| `authors` | List\<CreateAuthorCommand> | 否 | 创建时附带作者 |
| `fundIds` / `fundAssociations` | List | 否 | 论文基金关联 |

#### LabAchievementDTO / PublicAchievementDTO

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` | Long | 成果 ID |
| `title` / `titleEn` / `description` / `keywords` | String | 基本信息 |
| `type` / `typeDesc` | Integer / String | 成果类型 |
| `paperType` / `paperTypeDesc` | Integer / String | 论文子类型 |
| `projectType` / `projectTypeDesc` | Integer / String | 项目子类型 |
| `categoryId` / `categoryName` / `categoryFullPath` | Long / String | 新分类信息 |
| `venue` | String | 期刊/会议 |
| `publishDate` / `projectStartDate` / `projectEndDate` | LocalDate | 时间信息 |
| `reference` / `linkUrl` / `gitUrl` / `homepageUrl` / `pdfUrl` / `doi` | String | 外链 |
| `fundingAmount` | BigDecimal | 经费 |
| `ownerUserId` / `ownerUserName` | Long / String | 负责人（后台 DTO） |
| `published` / `isVerified` | Boolean | 状态 |
| `authors` | List\<LabPaperAuthorDTO> 或 List\<PublicPaperAuthorDTO> | 作者 |
| `fundIds` / `fundAssociations` | List | 基金 |
| `myVisibility` | Boolean | 仅“我的成果”查询返回 |
| `extra` | String | 扩展 |
| `createTime` / `updateTime` | Date | 记录时间 |

#### AddAuthorCommand / UpdateAuthorCommand / LabPaperAuthorDTO

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `userId` | Long | 内部作者 ID，空则表示外部作者 |
| `name` / `nameEn` | String | 作者姓名（外部作者必填） |
| `username` / `email` / `phone` / `studentNumber` | String | 自动绑定内部成员时可填（仅 `AddAuthorCommand`） |
| `affiliation` | String | 单位 |
| `authorOrder` | Integer | 作者排序（>=1，必填） |
| `isCorresponding` | Boolean | 是否通讯作者 |
| `role` | String | 贡献说明 |
| `visible` | Boolean | 是否在个人页展示（内部作者有效） |

`LabPaperAuthorDTO` 另包含 `id`、`paperId`、`isInternal`、`createTime`、`updateTime`。

#### LabFundAssociationDTO / FundAssociationCommand

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `fundId` | Long | 基金 ID |
| `amount` | BigDecimal | 资助金额（万元，可空） |

#### LabAchievementCategoryDTO / CategoryFlatItem

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` | Long | 分类 ID |
| `parentId` | Long | 父级 ID（null 表示一级） |
| `categoryCode` / `categoryName` / `categoryNameEn` | String | 编码、名称 |
| `description` | String | 描述 |
| `sortOrder` | Integer | 排序 |
| `isSystem` / `isActive` | Boolean | 是否系统内置 / 是否启用 |
| `icon` / `color` | String | 展示信息 |
| `parentName` | String | 父级名称 |
| `children` | List | 子节点 |
| `canDelete` / `canEdit` / `hasChildren` / `isUsed` | Boolean | 管理属性 |

`CategoryFlatItem` 用 `id/code/name/nameEn/parentId/level` 表示扁平节点。

#### CreateCategoryCommand / UpdateCategoryCommand / BatchUpdateSortCommand

| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `parentId` | Long | 父级类型（null=一级） |
| `categoryCode` | String | 唯一编码，创建可空 |
| `categoryName` / `categoryNameEn` | String | 中英文名称 |
| `description` | String | 描述 |
| `sortOrder` | Integer | 排序 |
| `isActive` | Boolean | 启用状态 |
| `icon` / `color` | String | 展示属性 |
| `items`（批量排序） | List\<SortItem> | `SortItem.id` + `SortItem.sortOrder` |

#### CategoryQuery
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `keyword` | String | 名称/编码模糊查询 |
| `parentId` | Long | 过滤指定父级 |
| `isActive` / `isSystem` | Boolean | 状态筛选 |
| `categoryCode` | String | 精确编码 |
| `includeChildren` | Boolean | 是否包含子项 |
| `topLevelOnly` / `secondLevelOnly` | Boolean | 仅查一级 / 二级 |

#### CategoryCompatibilityService.LegacyTypeMapping
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `type` | Integer | 旧类型（1=论文 2=项目） |
| `subType` | Integer | 旧子类型 |
| `typeName` / `subTypeName` | String | 对应名称 |

#### DictItem
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `value` | Integer | 枚举值 |
| `label` | String | 人类可读描述 |

#### LabPaperDTO / LabPaperQuery / PublicPaperQuery

`LabPaperDTO` 字段涵盖论文基础信息、作者列表、基金关联、`relatedProjects`（`List<RelatedProjectDTO>`，包含 `id/title/projectTypeId/projectTypeDesc/projectStartDate/projectEndDate`）、`published`、`verified` 等；`LabPaperQuery` 支持 `keyword`、`paperTypeId`、`ownerUserId`、`published`、`verified`、`dateStart/dateEnd`。`PublicPaperQuery` 继承前者并默认设置 `published=true`。

#### CreatePaperCommand
包含 `title`、`titleEn`、`description`、`keywords`、`paperTypeId`、`publication`、`conferenceName`、`issueNumber`、`publicationPlace`、`publisher`、`pageRange`、`publishDate`、`reference`、`doi`、`linkUrl`、`gitUrl`、`homepageUrl`、`pdfUrl`、`notes`、`published`、`authors`（`CreatePaperAuthorCommand`，含 `userId/name/nameEn/email/affiliation/authorOrder/corresponding/role/visible`）、`funds`（`PaperFundCommand`）、`projectIds`（`List<Long>`，论文归属的项目 ID 列表，可多选）。

#### LabProjectDTO / LabProjectQuery / CreateProjectCommand

`LabProjectDTO` 包含 `title/titleEn/description/keywords/projectTypeId/projectNumber/supporter/projectStartDate/projectEndDate/fundingAmount/amountDisplay/supportCn/supportEn/requirement/descText/reference/linkUrl/gitUrl/homepageUrl/pdfUrl/ownerUserId/published/verified/extra/categoryId/categoryName/categoryFullPath/typeInfo/createTime/updateTime/authors/relatedPapers`；`authors` 为 `List<LabPaperAuthorDTO>`，按 `authorOrder` 升序排列；`relatedPapers` 为 `List<RelatedPaperDTO>`（字段：`id/title/paperTypeId/paperTypeDesc/publishDate`）。

`LabProjectQuery` 支持 `keyword`、`projectTypeId`、`supporter`、`ownerUserId`、`published`、`verified`、`startDateBegin`、`startDateEnd`。

`CreateProjectCommand` 字段与 DTO 对应，并包含 `memberIds`（参与成员列表）。

#### PublicAchievementDTO / PublicPaperAuthorDTO

`PublicAchievementDTO` 为公开视图，字段与 `LabAchievementDTO` 大致相同但去除内部属性，并使用 `List<PublicPaperAuthorDTO>`（含 `name/nameEn/affiliation/corresponding/order`）。

---

## 4. 枚举附录

| 名称 | 取值 | 描述 |
| --- | --- | --- |
| `LabUserEntity.Identity` | 1=管理员 / 2=教师 / 3=学生 | 用户身份 |
| `LabUserEntity.AcademicStatus` | 0=实验室负责人 / 1=教授 / 2=副教授 / 3=讲师 / 4=博士 / 5=硕士 / 6=本科 | 学术身份 |
| `LabUserEntity.Status` | 1=在读/在职 / 2=毕业/离职 | 状态 |
| `LabAchievementEntity.PaperType` | 1=期刊论文 / 2=会议论文 / 3=书籍章节 / 4=专利 / 5=标准 / 6=研究报告 / 7=其他论文 | 论文子类型 |
| `LabAchievementEntity.ProjectType` | 1=国家重点项目 / 2=国家一般项目 / 3=省部级项目 / 4=企业合作项目 / 5=国际合作项目 / 6=青年基金 / 7=博士后基金 / 8=其他项目 | 项目子类型 |

以上内容覆盖了实验室用户管理（lab_user）与成果管理相关的全部接口、请求字段及返回结构，便于前端与测试同学查阅和对照实现/联调。
