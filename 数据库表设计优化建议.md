# 数据库表设计优化建议

## 📋 原设计分析

你的三表设计思路很好，但基于现有系统和需求，我建议以下优化：

## 🔧 优化后的表结构设计

### 1. 用户表 (lab_user)

```sql
CREATE TABLE lab_user (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    student_number VARCHAR(20) UNIQUE COMMENT '学号/工号',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '登录用户名',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    english_name VARCHAR(100) COMMENT '英文名',
    password VARCHAR(255) NOT NULL COMMENT '密码（加密）',
    gender TINYINT NOT NULL DEFAULT 0 COMMENT '性别：0=未知,1=男,2=女',
    identity TINYINT NOT NULL COMMENT '身份：1=管理员,2=教师,3=学生',
    academic_status TINYINT COMMENT '学术身份：1=教授,2=副教授,3=讲师,4=博士,5=硕士',
    research_area TEXT COMMENT '研究方向',
    phone VARCHAR(20) UNIQUE COMMENT '手机号',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态：1=在读/在职,2=毕业/离职',
    enrollment_year YEAR COMMENT '入学/入职年份',
    graduation_year YEAR COMMENT '毕业/离职年份',
    graduation_dest VARCHAR(255) COMMENT '毕业去向',
    photo VARCHAR(255) COMMENT '照片路径',
    resume TEXT COMMENT '个人简历',
    homepage_url VARCHAR(255) COMMENT '个人主页',
    orcid VARCHAR(50) COMMENT 'ORCID ID',
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '账号是否启用',
    
    -- 系统字段
    creator_id BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater_id BIGINT COMMENT '更新人ID', 
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted BOOLEAN DEFAULT FALSE COMMENT '是否删除',
    
    INDEX idx_student_number (student_number),
    INDEX idx_username (username),
    INDEX idx_identity_status (identity, academic_status),
    INDEX idx_enrollment_year (enrollment_year)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='实验室用户表';
```

### 2. 成果表 (lab_achievement) 

```sql
CREATE TABLE lab_achievement (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '成果ID',
    type TINYINT NOT NULL COMMENT '成果类型：1=论文,2=专利,3=项目,4=基金,5=软著,6=奖项',
    title VARCHAR(500) NOT NULL COMMENT '成果标题',
    title_en VARCHAR(500) COMMENT '英文标题',
    description TEXT COMMENT '描述/摘要',
    keywords VARCHAR(255) COMMENT '关键词',
    
    -- 论文相关字段
    journal VARCHAR(255) COMMENT '期刊/会议名称',
    volume VARCHAR(50) COMMENT '卷号',
    issue VARCHAR(50) COMMENT '期号',
    pages VARCHAR(50) COMMENT '页码',
    doi VARCHAR(100) COMMENT 'DOI',
    issn VARCHAR(20) COMMENT 'ISSN',
    impact_factor DECIMAL(5,3) COMMENT '影响因子',
    
    -- 专利相关字段
    patent_number VARCHAR(100) COMMENT '专利号',
    patent_type TINYINT COMMENT '专利类型：1=发明,2=实用新型,3=外观设计',
    application_date DATE COMMENT '申请日期',
    authorization_date DATE COMMENT '授权日期',
    
    -- 项目/基金相关字段
    project_number VARCHAR(100) COMMENT '项目编号',
    funding_amount DECIMAL(12,2) COMMENT '资助金额（万元）',
    funding_agency VARCHAR(255) COMMENT '资助机构',
    
    -- 通用字段
    start_date DATE COMMENT '开始时间',
    end_date DATE COMMENT '结束时间',
    publish_date DATE COMMENT '发表/授权日期',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态：1=进行中,2=已完成,3=已发表,4=已授权',
    level TINYINT COMMENT '级别：1=国际,2=国家,3=省部,4=市厅,5=校级',
    url VARCHAR(500) COMMENT '相关链接',
    file_path VARCHAR(500) COMMENT '文件存储路径',
    
    -- 系统字段
    creator_id BIGINT NOT NULL COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater_id BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted BOOLEAN DEFAULT FALSE COMMENT '是否删除',
    
    INDEX idx_type_status (type, status),
    INDEX idx_publish_date (publish_date),
    INDEX idx_creator (creator_id),
    INDEX idx_project_number (project_number),
    INDEX idx_patent_number (patent_number),
    FULLTEXT idx_title_desc (title, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='实验室成果表';
```

### 3. 成果-用户关联表 (lab_achievement_user) 

```sql
CREATE TABLE lab_achievement_user (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '关联ID',
    achievement_id BIGINT NOT NULL COMMENT '成果ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    author_order TINYINT COMMENT '作者排序：1=第一作者,2=第二作者...',
    role VARCHAR(50) COMMENT '作者角色：第一作者,通讯作者,共同作者等',
    is_corresponding BOOLEAN DEFAULT FALSE COMMENT '是否通讯作者',
    contribution_rate DECIMAL(5,2) COMMENT '贡献比例(%)',
    
    -- 系统字段
    creator_id BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater_id BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted BOOLEAN DEFAULT FALSE COMMENT '是否删除',
    
    UNIQUE KEY uk_achievement_user (achievement_id, user_id),
    INDEX idx_achievement (achievement_id),
    INDEX idx_user (user_id),
    INDEX idx_author_order (author_order),
    
    FOREIGN KEY (achievement_id) REFERENCES lab_achievement(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES lab_user(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成果用户关联表';
```

### 4. 新增：成果类型配置表 (lab_achievement_type)

```sql
CREATE TABLE lab_achievement_type (
    id TINYINT AUTO_INCREMENT PRIMARY KEY COMMENT '类型ID',
    type_name VARCHAR(50) NOT NULL COMMENT '类型名称',
    type_code VARCHAR(20) NOT NULL UNIQUE COMMENT '类型编码',
    description VARCHAR(255) COMMENT '类型描述',
    sort_order TINYINT DEFAULT 0 COMMENT '排序',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成果类型配置表';

-- 初始化数据
INSERT INTO lab_achievement_type (type_name, type_code, description, sort_order) VALUES
('论文', 'PAPER', '学术论文', 1),
('专利', 'PATENT', '发明专利、实用新型等', 2),
('项目', 'PROJECT', '科研项目', 3),
('基金', 'FUND', '科研基金', 4),
('软件著作权', 'SOFTWARE', '软件著作权', 5),
('奖项', 'AWARD', '科研奖项', 6);
```

## 🔄 与现有系统的整合建议

### 1. 保留现有表结构
- 保持现有的 `sys_user`, `sys_role`, `sys_menu` 等系统表
- 新的 `lab_user` 表通过 `username` 字段关联 `sys_user` 表

### 2. 数据迁移策略
```sql
-- 将现有 lab_member 数据迁移到新的 lab_user 表
INSERT INTO lab_user (student_number, username, real_name, english_name, identity, academic_status, enrollment_year, is_active)
SELECT 
    CONCAT('LAB', LPAD(id, 4, '0')) as student_number,
    byname as username,
    name as real_name,
    byname as english_name,
    CASE 
        WHEN type IN (8,9,10) THEN 2  -- 教师
        WHEN type IN (11,12) THEN 3   -- 学生
        ELSE 3
    END as identity,
    CASE 
        WHEN type = 8 THEN 1   -- 教授
        WHEN type = 9 THEN 2   -- 副教授
        WHEN type = 10 THEN 3  -- 讲师
        WHEN type = 11 THEN 4  -- 博士
        WHEN type = 12 THEN 5  -- 硕士
        ELSE NULL
    END as academic_status,
    COALESCE(join_year, 2020) as enrollment_year,
    NOT is_off as is_active
FROM lab_member;
```

## 🎯 权限设计建议

### 1. 角色权限矩阵

| 功能 | 管理员 | 教师 | 学生 |
|------|--------|------|------|
| 用户管理 | 全部 | 查看 | 查看 |
| 个人信息 | 全部 | 自己 | 自己 |
| 成果管理 | 全部 | 参与的 | 参与的 |
| 成果查看 | 全部 | 全部 | 全部 |
| 系统配置 | 全部 | 无 | 无 |

### 2. 数据权限控制
```sql
-- 在应用层实现数据权限过滤
-- 教师和学生只能操作自己参与的成果
SELECT a.* FROM lab_achievement a
JOIN lab_achievement_user au ON a.id = au.achievement_id
WHERE au.user_id = #{currentUserId}
AND a.deleted = FALSE;
```

## 📝 主要改进点

1. **字段扩展**: 增加了英文名、ORCID、个人主页等学术相关字段
2. **成果分类**: 支持论文、专利、项目、基金等多种成果类型
3. **详细信息**: 为不同类型成果添加了专门的字段
4. **作者信息**: 支持作者排序、角色、贡献比例等
5. **系统字段**: 统一的创建人、更新人、软删除等字段
6. **索引优化**: 为常用查询字段添加索引
7. **数据完整性**: 添加外键约束和唯一约束
8. **扩展性**: 通过类型表支持成果类型的动态扩展

这个设计既保持了你原有的简洁思路，又增强了功能完整性和扩展性。
