# 🌐 前端接口对接完整指南

## 📋 接口提供方式总览

你的实验室用户管理系统为前端提供了多种接口对接方式：

### 1. 📚 Swagger UI 在线文档 (推荐)

**访问地址**: http://localhost:8080/swagger-ui.html

**特点**:
- 🔥 **实时更新**: 自动生成最新的接口文档
- 🧪 **在线测试**: 可以直接在浏览器中测试接口
- 📖 **完整文档**: 包含请求参数、响应格式、错误码等
- 🎯 **分组管理**: 按功能模块分组显示

**接口分组**:
- **公共API**: 登录、注册等通用接口
- **内置系统API**: 系统管理相关接口
- **实验室管理API**: 你的用户CRUD接口 🆕

### 2. 📄 静态API文档

**文件位置**: `前端API接口文档.md`

**特点**:
- 📝 **详细说明**: 包含TypeScript类型定义
- 💻 **代码示例**: React、Vue等框架的集成示例
- 🔐 **权限说明**: 详细的权限控制说明
- 🛡️ **安全指南**: Token管理和安全注意事项

### 3. 🚀 快速测试工具

**Postman Collection**: `实验室用户管理API.postman_collection.json`
**测试脚本**: `快速接口测试脚本.sh`

## 🔗 接口访问信息

### 基础配置
```javascript
const API_CONFIG = {
  baseURL: 'http://localhost:8080',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer {your_jwt_token}'
  }
}
```

### 认证Token
```javascript
// 获取Token后设置到请求头
axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;

// 或者在每个请求中设置
const response = await axios.get('/lab/users/profile', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

## 🎯 核心接口列表

### 🔍 查询接口
| 接口 | 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|------|
| 获取当前用户信息 | GET | `/lab/users/profile` | 登录用户 | 获取个人详细信息 |
| 分页查询用户列表 | GET | `/lab/users/crud/list` | 管理员 | 支持筛选和分页 |
| 搜索用户 | GET | `/lab/users/crud/search` | 无限制 | 关键词模糊搜索 |
| 检查用户存在 | GET | `/lab/users/{id}/exists` | 登录用户 | 验证用户是否存在 |

### ➕ 创建接口
| 接口 | 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|------|
| 创建新用户 | POST | `/lab/users/crud` | 管理员 | 创建实验室用户 |

### ✏️ 更新接口
| 接口 | 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|------|
| 更新个人信息 | PUT | `/lab/users/crud/profile` | 登录用户 | 修改自己的信息 |
| 修改密码 | PUT | `/lab/users/crud/password` | 登录用户 | 修改登录密码 |
| 管理员更新用户 | PUT | `/lab/users/crud/{id}` | 管理员 | 修改任意用户信息 |

### 🗑️ 删除接口
| 接口 | 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|------|
| 删除用户 | DELETE | `/lab/users/crud/{id}` | 管理员 | 软删除用户 |
| 批量删除 | DELETE | `/lab/users/crud/batch` | 管理员 | 批量删除多个用户 |

## 💻 前端集成示例

### React + Axios
```typescript
// api/userService.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000,
});

// 请求拦截器 - 添加Token
api.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器 - 处理错误
api.interceptors.response.use(
  response => response.data,
  error => {
    if (error.response?.status === 401) {
      // Token过期，跳转登录
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export const userService = {
  // 获取当前用户信息
  getCurrentUser: () => api.get('/lab/users/profile'),
  
  // 获取用户列表
  getUserList: (params) => api.get('/lab/users/crud/list', { params }),
  
  // 搜索用户
  searchUsers: (keyword) => api.get('/lab/users/crud/search', { 
    params: { keyword } 
  }),
  
  // 创建用户
  createUser: (data) => api.post('/lab/users/crud', data),
  
  // 更新个人信息
  updateProfile: (data) => api.put('/lab/users/crud/profile', data),
  
  // 修改密码
  changePassword: (data) => api.put('/lab/users/crud/password', data),
  
  // 删除用户
  deleteUser: (id) => api.delete(`/lab/users/crud/${id}`),
};
```

### Vue 3 + Composition API
```typescript
// composables/useUser.ts
import { ref, reactive } from 'vue';
import { userService } from '@/api/userService';

export function useUser() {
  const currentUser = ref(null);
  const userList = reactive({
    data: [],
    total: 0,
    loading: false
  });

  const getCurrentUser = async () => {
    try {
      const response = await userService.getCurrentUser();
      currentUser.value = response.data;
    } catch (error) {
      console.error('获取用户信息失败:', error);
    }
  };

  const getUserList = async (params = {}) => {
    userList.loading = true;
    try {
      const response = await userService.getUserList(params);
      userList.data = response.data.rows;
      userList.total = response.data.total;
    } catch (error) {
      console.error('获取用户列表失败:', error);
    } finally {
      userList.loading = false;
    }
  };

  return {
    currentUser,
    userList,
    getCurrentUser,
    getUserList
  };
}
```

## 🔐 权限控制

### 前端权限判断
```typescript
// utils/permission.ts
export const hasPermission = (permission: string): boolean => {
  const userPermissions = getUserPermissions(); // 从用户信息中获取权限
  return userPermissions.includes(permission);
};

export const isAdmin = (): boolean => {
  const user = getCurrentUser();
  return user?.identity === 1; // 1=管理员
};

// 在组件中使用
const canCreateUser = isAdmin();
const canEditProfile = hasPermission('lab:user:edit');
```

### 路由守卫
```typescript
// router/guards.ts
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token');
  
  if (to.meta.requiresAuth && !token) {
    next('/login');
    return;
  }
  
  if (to.meta.requiresAdmin && !isAdmin()) {
    next('/403'); // 无权限页面
    return;
  }
  
  next();
});
```

## 🧪 测试和调试

### 1. 使用Swagger UI测试
1. 访问 http://localhost:8080/swagger-ui.html
2. 选择"实验室管理API"分组
3. 点击具体接口进行测试
4. 在"Authorize"按钮中输入Token

### 2. 使用Postman测试
1. 导入 `实验室用户管理API.postman_collection.json`
2. 设置环境变量中的Token
3. 运行Collection进行批量测试

### 3. 使用浏览器开发者工具
```javascript
// 在控制台中快速测试
fetch('http://localhost:8080/lab/users/profile', {
  headers: {
    'Authorization': 'Bearer your_token_here'
  }
})
.then(res => res.json())
.then(data => console.log(data));
```

## 🚨 常见问题和解决方案

### 1. CORS跨域问题
**现象**: 浏览器报CORS错误
**解决**: 后端已配置CORS，确保请求头正确

### 2. Token过期
**现象**: 返回401错误
**解决**: 重新登录获取新Token，或实现Token自动刷新

### 3. 权限不足
**现象**: 返回403错误
**解决**: 检查用户权限，使用管理员账号测试

### 4. 中文乱码
**现象**: 返回的中文显示为乱码
**解决**: 设置正确的Content-Type和字符编码

## 📱 移动端适配

### React Native
```typescript
// 使用fetch或axios
const response = await fetch('http://localhost:8080/lab/users/profile', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
});
```

### 小程序
```javascript
// 微信小程序
wx.request({
  url: 'http://localhost:8080/lab/users/profile',
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  success: (res) => {
    console.log(res.data);
  }
});
```

## 🔄 数据格式说明

### 统一响应格式
```typescript
interface ApiResponse<T> {
  code: number;    // 0=成功, 其他=失败
  msg: string;     // 响应消息
  data: T;         // 响应数据
}
```

### 分页数据格式
```typescript
interface PageResponse<T> {
  total: number;   // 总记录数
  rows: T[];       // 当前页数据
}
```

---

**🎉 恭喜！** 你现在拥有了完整的前端接口对接方案！前端开发者可以通过多种方式快速集成你的实验室用户管理接口。
