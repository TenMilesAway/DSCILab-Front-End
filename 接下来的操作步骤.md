# 接下来的操作步骤指南

## 🎉 当前状态

✅ **数据库表**: 已创建 `lab_user` 表并插入测试数据  
✅ **代码编译**: 所有代码编译成功  
✅ **应用启动**: 后端服务运行在 http://localhost:8080  
✅ **接口创建**: 实验室用户管理接口已完成  

## 🔧 第四步：解决登录问题并测试接口

### 4.1 临时解决方案 - 创建测试接口

由于系统使用RSA加密登录，我们先创建一个不需要登录的测试接口：

```bash
# 1. 停止当前应用
# 按 Ctrl+C 停止应用

# 2. 添加测试接口（无需认证）
# 在 LabUserController 中添加一个公开接口
```

### 4.2 修改安全配置

需要在 `SecurityConfig` 中添加我们的接口到白名单：

```java
// 在 SecurityConfig.java 中添加
.antMatchers("/lab/users/*/exists").permitAll()
.antMatchers("/lab/users/test/**").permitAll()
```

### 4.3 获取正确的登录Token

有几种方式解决登录问题：

#### 方式1: 使用现有系统用户
```bash
# 查看系统中的用户
docker exec mysql8 mysql -uroot -p12345 -e "USE web; SELECT username FROM sys_user WHERE status = 1;"

# 使用正确的密码（可能是 123456 或其他）
```

#### 方式2: 创建新的测试用户
```sql
-- 在数据库中创建一个简单的测试用户
INSERT INTO sys_user (username, nickname, password, status, is_admin) 
VALUES ('testuser', '测试用户', '$2a$10$7JB720yubVSOfvVWdBYoOe.PuiKloYAjYcGpVFurpKhS6gqpHxYw6', 1, false);
```

#### 方式3: 禁用密码加密（仅用于测试）
临时修改 `LoginService.java` 中的密码解密逻辑。

## 🧪 第五步：测试接口功能

### 5.1 获取Token后测试

一旦获得有效Token，测试以下接口：

```bash
# 设置Token变量
TOKEN="your-jwt-token-here"

# 1. 测试获取当前用户信息
curl -X GET "http://localhost:8080/lab/users/profile" \
  -H "Authorization: Bearer $TOKEN"

# 2. 测试根据ID获取用户信息
curl -X GET "http://localhost:8080/lab/users/1" \
  -H "Authorization: Bearer $TOKEN"

# 3. 测试根据用户名获取信息
curl -X GET "http://localhost:8080/lab/users/username/admin" \
  -H "Authorization: Bearer $TOKEN"

# 4. 测试检查用户是否存在
curl -X GET "http://localhost:8080/lab/users/1/exists" \
  -H "Authorization: Bearer $TOKEN"

# 5. 测试检查用户名是否存在
curl -X GET "http://localhost:8080/lab/users/username/admin/exists" \
  -H "Authorization: Bearer $TOKEN"
```

### 5.2 验证权限控制

测试不同角色的权限：

```bash
# 管理员应该能访问所有用户信息
# 普通用户只能访问自己的信息
```

## 🚀 第六步：扩展功能开发

### 6.1 成果管理接口

基于现有架构，继续开发：

#### 6.1.1 创建成果相关表
```sql
-- 创建成果表
CREATE TABLE lab_achievement (...);

-- 创建成果用户关联表  
CREATE TABLE lab_achievement_user (...);
```

#### 6.1.2 创建成果管理接口
```java
// 1. 创建实体类
LabAchievementEntity.java

// 2. 创建DTO类
LabAchievementDTO.java

// 3. 创建服务类
LabAchievementService.java

// 4. 创建控制器
LabAchievementController.java
```

#### 6.1.3 成果管理功能
- 论文管理 (CRUD)
- 专利管理 (CRUD)  
- 项目管理 (CRUD)
- 基金管理 (CRUD)
- 成果统计和查询

### 6.2 用户信息修改接口

```java
// 添加用户信息修改接口
@PutMapping("/profile")
public ResponseDTO<Void> updateProfile(@RequestBody UpdateProfileCommand command);

// 添加密码修改接口
@PutMapping("/password")  
public ResponseDTO<Void> changePassword(@RequestBody ChangePasswordCommand command);

// 添加头像上传接口
@PostMapping("/avatar")
public ResponseDTO<String> uploadAvatar(@RequestParam("file") MultipartFile file);
```

### 6.3 用户列表和搜索

```java
// 用户列表查询（分页）
@GetMapping
public ResponseDTO<PageDTO<LabUserProfileDTO>> getUserList(LabUserQuery query);

// 用户搜索
@GetMapping("/search")
public ResponseDTO<List<LabUserProfileDTO>> searchUsers(@RequestParam String keyword);
```

## 📋 第七步：前端对接

### 7.1 提供给前端的信息

1. **API文档**: `实验室用户API接口文档.md`
2. **接口地址**: `http://localhost:8080`
3. **认证方式**: JWT Token
4. **测试账号**: 提供测试用户名和密码

### 7.2 前端需要实现的功能

1. **登录页面**: 获取Token
2. **个人信息页面**: 显示和编辑个人信息
3. **用户管理页面**: 管理员查看所有用户
4. **成果管理页面**: 管理论文、专利、项目等

## 🔍 第八步：测试和调试

### 8.1 单元测试

```java
// 为关键业务逻辑编写单元测试
@Test
public void testGetCurrentUserProfile() {
    // 测试获取当前用户信息
}

@Test  
public void testUserPermission() {
    // 测试权限控制
}
```

### 8.2 集成测试

```bash
# 使用Postman或其他工具进行完整的API测试
# 测试各种边界情况和错误处理
```

### 8.3 性能测试

```bash
# 使用JMeter或其他工具进行压力测试
# 测试数据库查询性能
# 测试并发访问
```

## 📝 第九步：部署准备

### 9.1 生产环境配置

```yaml
# application-prod.yml
spring:
  datasource:
    dynamic:
      datasource:
        master:
          url: jdbc:mysql://prod-db:3306/web
          username: ${DB_USERNAME}
          password: ${DB_PASSWORD}
  redis:
    host: ${REDIS_HOST}
    port: ${REDIS_PORT}
    password: ${REDIS_PASSWORD}
```

### 9.2 Docker部署

```dockerfile
# Dockerfile
FROM openjdk:8-jre-alpine
COPY target/agileboot-admin-1.0.0.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar", "--spring.profiles.active=prod"]
```

### 9.3 数据库迁移

```sql
-- 生产环境数据库初始化脚本
-- 包含表结构和基础数据
```

## 🎯 优先级建议

### 高优先级 (立即执行)
1. ✅ 解决登录问题，获取有效Token
2. ✅ 测试现有的5个用户管理接口
3. ✅ 验证权限控制是否正常工作

### 中优先级 (本周完成)
1. 🔄 开发用户信息修改接口
2. 🔄 开发成果管理基础接口
3. 🔄 编写基础的单元测试

### 低优先级 (后续迭代)
1. ⏳ 完善成果管理的高级功能
2. ⏳ 开发统计和报表功能
3. ⏳ 性能优化和部署准备

---

**下一步行动**: 首先解决登录问题，然后立即测试我们创建的接口功能！
